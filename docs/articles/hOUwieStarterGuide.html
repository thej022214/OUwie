<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>hOUwie User Guide • OUwie</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="hOUwie User Guide">
<meta property="og:description" content="OUwie">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">OUwie</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/OUwie_2.1_adds.html">New additions as of OUwie 2.1</a>
    </li>
    <li>
      <a href="../articles/hOUwieStarterGuide.html">hOUwie User Guide</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/thej022214/OUwie/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>hOUwie User Guide</h1>
                        <h4 data-toc-skip class="author">.</h4>
            
            <h4 data-toc-skip class="date">11/07/2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/thej022214/OUwie/blob/HEAD/vignettes/hOUwieStarterGuide.Rmd" class="external-link"><code>vignettes/hOUwieStarterGuide.Rmd</code></a></small>
      <div class="hidden name"><code>hOUwieStarterGuide.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="section level3">
<h3 id="preface">Preface<a class="anchor" aria-label="anchor" href="#preface"></a>
</h3>
<p>The purpose of this guide is to give a brief overview of the some of
the features that the addition of the hOUwie function will provide users
of OUwie and those generally interested in linking discrete and
continuous datasets. In this document you will find an introduction
briefly describing the motivation for the development of hOUwie, an
example for the basic use of OUwie using manly default models, and an
example of how to utilize the generalized framework of hOUwie to
strucuture models specific to your hypotheses. If you have any questions
or bug reports feel free to email me at jamesboyko21 [at] gmail.com</p>
</div>
<div class="section level3">
<h3 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h3>
<p>The major difference between this function and those previously
published is that we explicitly link the discrete and continuous
probabilities in a joint framework. We discuss this in depth in the
associated hOUwie paper, but briefly what we do here is calculate the
probability of an underlying regime painting based on both the
probability of the continuous character distribution (standard for OU
models) AND the probability of the discrete character distribution. Most
methods to this point will ignore one of these probabilities. We then
integrate over many high probability regime mappings. The effect this
has in practice is that we weight mappings that are good for both
discrete and continuous characters higher than alternatives because
those have the highest joint probability. If one was to generate regimes
using stochastic mappings, then you are generating maps ignoring the
probability of the continuous character distribution so you end up with
mappings that are high for the discrete character, but not the
continuous. In contrast, if you were to generate mappings using an
iterative approach which attempt to maximize the probability of the
continuous character, you would be ignoring the probability of the
discrete character’s distribution.</p>
</div>
</div>
<div class="section level2">
<h2 id="the-actual-guide">The Actual Guide<a class="anchor" aria-label="anchor" href="#the-actual-guide"></a>
</h2>
<div class="section level3">
<h3 id="the-dataset">The dataset<a class="anchor" aria-label="anchor" href="#the-dataset"></a>
</h3>
<p>We will use the tworegime dataset provided by OUwie.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">tworegime</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Genus_species Reg        X</span></span>
<span><span class="co">## 1            t1   1 1.837606</span></span>
<span><span class="co">## 2            t2   1 1.892257</span></span>
<span><span class="co">## 3            t3   1 1.503890</span></span>
<span><span class="co">## 4            t4   1 1.285335</span></span>
<span><span class="co">## 5            t5   1 2.406545</span></span>
<span><span class="co">## 6            t6   1 1.596806</span></span></code></pre>
<p>Here we can see the structure of the dataset which is species name in
column one, discrete character in column two, and the continuous
character in column 3. However, this is not the only type of data that
is accepted in hOUwie. We allow for any number of discrete characters
and states. Let’s say that our dataset contains character X (presence or
absence of scent) and character Y (present or absence of colored
petals). To round things out, we also have a continuous measure of
flower size.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">tworegime</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sp <span class="op">=</span> <span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span>,</span>
<span>                  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                  Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                  FS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span>, <span class="fl">10</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   sp X Y        FS</span></span>
<span><span class="co">## 1 t1 0 0 10.412204</span></span>
<span><span class="co">## 2 t2 1 1 12.808589</span></span>
<span><span class="co">## 3 t3 0 1  7.070618</span></span>
<span><span class="co">## 4 t4 0 0 13.747916</span></span>
<span><span class="co">## 5 t5 1 1  4.271718</span></span>
<span><span class="co">## 6 t6 0 0  8.942825</span></span></code></pre>
<p>Things get a little more complex when we consider the above dataset,
since now we have to consider the correlation between X and Y as well as
the correlation to flower size. This will be more important for people
constructing their own custom models (which I recommend for anyone).
Know that by default, we will structure the discrete model for X and Y
as correlated.</p>
<p>Finally, it is also possible to include measurement error for your
continuous character. That just has to be located in the last column of
your data.</p>
<p>I also note that for the three.point algorithm to work trees are
expected to be ultrametric (although in testing non-ultrametric trees
seeming to work).</p>
</div>
<div class="section level3">
<h3 id="basic-usage">Basic usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h3>
<p>Basic usage for hOUwie requires the specification of your phylogeny,
your trait dataset, the number of rate categories (&gt;1 if you wish to
include hidden states), your discrete character model, your continuous
character model, and the number of underlying regimes to evaluate per
iteration. For the purposes of this vignette (and so CRAN doesn’t yell
at us), I’m not going to run any actual optimizations and just use a
fixed set of parameters to evaluate the likelihood. When you use it,
most likely you will not set an argument for p and just leave that out
of your hOUwie function call.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01670113</span>, <span class="fl">0.39489947</span>, <span class="fl">0.18619839</span>, <span class="fl">1.67259459</span>, <span class="fl">0.16817414</span><span class="op">)</span> <span class="co"># my fixed set of parameters</span></span>
<span><span class="va">pp_oum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hOUwie.html">hOUwie</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">trait</span>, rate.cat <span class="op">=</span> <span class="fl">1</span>, discrete_model <span class="op">=</span> <span class="st">"ER"</span>, </span>
<span>                continuous_model <span class="op">=</span> <span class="st">"OUM"</span>, nSim <span class="op">=</span> <span class="fl">25</span>, p <span class="op">=</span> <span class="va">p</span><span class="op">)</span> <span class="co"># you likely won't use this p argument</span></span></code></pre></div>
<pre><code><span><span class="co">## Negative values detected... adding 50 to the trait mean for optimization purposes</span></span>
<span><span class="co">## Your phylogeny had node labels, these have been removed.</span></span>
<span><span class="co">## Calculating likelihood from a set of fixed parameters.</span></span>
<span><span class="co">## [1]  0.01670113  0.39489947  0.18619839 51.67259459 50.16817414</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pp_oum</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Fit</span></span>
<span><span class="co">##    lnLTot   lnLDisc   lnLCont    AIC     AICc      BIC nTaxa nPars</span></span>
<span><span class="co">##  -25.1665 -5.268176 -19.40598 60.333 61.36748 71.12741    64     5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Legend</span></span>
<span><span class="co">##   1   2 </span></span>
<span><span class="co">## "1" "2" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regime Rate matrix</span></span>
<span><span class="co">##            (1)        (2)</span></span>
<span><span class="co">## (1)         NA 0.01670113</span></span>
<span><span class="co">## (2) 0.01670113         NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## OU Estimates</span></span>
<span><span class="co">##              (1)       (2)</span></span>
<span><span class="co">## alpha  0.3948995 0.3948995</span></span>
<span><span class="co">## sigma2 0.1861984 0.1861984</span></span>
<span><span class="co">## theta  1.6725946 0.1681741</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Half-life (another way of reporting alpha)</span></span>
<span><span class="co">##     (1)     (2) </span></span>
<span><span class="co">## 1.75525 1.75525</span></span></code></pre>
<p>Let’s breakdown what we see here.</p>
<p>Fit: You will see the total log likelihood (lnLTot), the marginal
discrete likeilhood (lnLDisc), the marginal continuous likelihood
(lnLCont), the Akaike Information Criterion (AIC), the sample size
corrected Akaike Information Criterion (AICc), the Bayesian Information
criterion (BIC), the number of taxa analyzed (nTaxa), and the number of
parameters in the model (nPars). The most important numbers here are
your lnLTot and the AIC (or AICc) since those are what will be used in
some downstream analyses and evaluate the relative fit of this model to
the data.</p>
<p>Legend: This is a named vector. Elements of vector (appear in the
quotation marks) match the input data and above them is their
corresponding state in the hOUwie model.</p>
<p>Regime Rate matrix: This is the model of discrete character
evolution. It is a Markov model which can be read as the probability of
transitioning FROM a row to a particular column. For example, to know
the transition rate from state (1) to state (2) we look in the upper
right hand of the matrix.</p>
<p>OU Estimates: The model of continuous character evolution. Alpha,
sigma2, and theta are all parameters used in the OU model of which there
has been plenty written about interpretation. In each column is the
estimate for a particular discrete state and regime state. This model
was an OUM which allows a different theta (or optima) and you can see
those are the only two parameters that differ. In this case, state (2)
has a lower optimum than state (1).</p>
<p>Half-life (another way of reporting alpha): Like it says, this is
another way of reporting alpha. It’s just ln(2)/alpha. The nice thing is
that, unlike alpha, this is in units of time. Like the half-life of
radioactive materials, this represents the time it takes for the initial
ancestral value to reach halfway to the optimum. You’ll want to look at
your half-life relative to your trees age. If the half-life is much
smaller than the tree age, then this is saying there is little
phylogenetic signal in your dataset.</p>
</div>
<div class="section level3">
<h3 id="basic-usage---model-comparison">Basic usage - model comparison<a class="anchor" aria-label="anchor" href="#basic-usage---model-comparison"></a>
</h3>
<p>Okay, so we have run a model that asks whether the optimum of our
continuous character is correlated with a discrete character and got a
result. Now we need to test some alternative hypothesis. We need to see
if this data can be equally explained by some distributions which do not
require a correlation. Or maybe it’s not that the optimum is correlated,
but rather it’s just that the rates of evolution differ between states
(1) and (2).</p>
<p>We will run the BM1, OU1, and BMV models. Importantly, BM1 and OU1
models expect no link between the discrete and continuous characters.
I.e., all of the parameters are identical for states (1) and (2). BMV on
the other hand suggests that the rates of evolution in state (1) differ
from those in state (2) as measure by sigma2.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_bm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01663838</span>, <span class="fl">0.13324222</span>, <span class="fl">1.32800027</span><span class="op">)</span> </span>
<span><span class="va">pp_bm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hOUwie.html">hOUwie</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">trait</span>, rate.cat <span class="op">=</span> <span class="fl">1</span>, discrete_model <span class="op">=</span> <span class="st">"ER"</span>, </span>
<span>                continuous_model <span class="op">=</span> <span class="st">"BM1"</span>, nSim <span class="op">=</span> <span class="fl">25</span>, p <span class="op">=</span> <span class="va">p_bm1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Negative values detected... adding 50 to the trait mean for optimization purposes</span></span>
<span><span class="co">## Your phylogeny had node labels, these have been removed.</span></span>
<span><span class="co">## Calculating likelihood from a set of fixed parameters.</span></span>
<span><span class="co">## [1]  0.01663838  0.13324222 51.32800027</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_ou1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01686173</span>, <span class="fl">0.16642882</span>, <span class="fl">0.17165229</span>, <span class="fl">1.33223112</span><span class="op">)</span></span>
<span><span class="va">pp_ou1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hOUwie.html">hOUwie</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">trait</span>, rate.cat <span class="op">=</span> <span class="fl">1</span>, discrete_model <span class="op">=</span> <span class="st">"ER"</span>, </span>
<span>                continuous_model <span class="op">=</span> <span class="st">"OU1"</span>, nSim <span class="op">=</span> <span class="fl">25</span>, p <span class="op">=</span> <span class="va">p_ou1</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Negative values detected... adding 50 to the trait mean for optimization purposes</span></span>
<span><span class="co">## Your phylogeny had node labels, these have been removed.</span></span>
<span><span class="co">## Calculating likelihood from a set of fixed parameters.</span></span>
<span><span class="co">## [1]  0.01686173  0.16642882  0.17165229 51.33223112</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_bmv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01662943</span>, <span class="fl">0.06926977</span>, <span class="fl">0.19887583</span>, <span class="fl">1.46411994</span><span class="op">)</span></span>
<span><span class="va">pp_bmv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hOUwie.html">hOUwie</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">trait</span>, rate.cat <span class="op">=</span> <span class="fl">1</span>, discrete_model <span class="op">=</span> <span class="st">"ER"</span>, </span>
<span>                continuous_model <span class="op">=</span> <span class="st">"BMV"</span>, nSim <span class="op">=</span> <span class="fl">25</span>, p <span class="op">=</span> <span class="va">p_bmv</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Negative values detected... adding 50 to the trait mean for optimization purposes</span></span>
<span><span class="co">## Your phylogeny had node labels, these have been removed.</span></span>
<span><span class="co">## Calculating likelihood from a set of fixed parameters.</span></span>
<span><span class="co">## [1]  0.01662943  0.06926977  0.19887583 51.46411994</span></span></code></pre>
<p>To evaluate which model is the best, there is a function in hOUwie
that will quickly summarize a set of models. But they must first be
input into a list.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bm1_fit <span class="op">=</span> <span class="va">pp_bm1</span>, ou1_fit <span class="op">=</span> <span class="va">pp_ou1</span>, bmv_fit <span class="op">=</span> <span class="va">pp_bmv</span>, oum_fit <span class="op">=</span> <span class="va">pp_oum</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/getModelTable.html">getModelTable</a></span><span class="op">(</span><span class="va">model_set</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         np     lnLik   DiscLik   ContLik      BIC     dBIC      BICwt</span></span>
<span><span class="co">## bm1_fit  3 -27.21968 -5.260506 -18.74030 66.91602 4.005475 0.11547090</span></span>
<span><span class="co">## ou1_fit  4 -27.18725 -5.268256 -18.70012 71.01004 8.099494 0.01490965</span></span>
<span><span class="co">## bmv_fit  4 -23.13751 -5.257222 -16.23687 62.91054 0.000000 0.85555963</span></span>
<span><span class="co">## oum_fit  5 -25.16650 -5.268176 -19.40598 71.12741 8.216869 0.01405983</span></span></code></pre>
<p>So BMV (variable sigma model) is currently the best fitting model.
But, we are biasing ourselves towards finding correlation because we may
be misconstruing evidence of rate heterogeneity as evidence of
correlation. The problem is that all of our current null models do not
allow for any rate variation or optima variation. On the other hand,
correlated models do allow for rate variation linked to the focal
character. So, if there is a signal of rate heterogeneity then we may
choose a correlated model because it allows for rate variation even if
it is not linked to the focal character (i.e., actually correlated). We
can account for this with CID+ models which allow for variable parameter
models without it being linked to an observed character. To do this we
simply set null.model to TRUE.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_bmv_cid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.915276e+02</span>, <span class="fl">5.319353e-03</span>, <span class="fl">1.728115e-04</span>, <span class="fl">5.529171e+00</span>, <span class="fl">2.053390e-01</span>, <span class="fl">1.666330e-01</span>, <span class="fl">1.318453e+00</span><span class="op">)</span></span>
<span><span class="va">pp_bmv_cid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hOUwie.html">hOUwie</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">trait</span>, rate.cat <span class="op">=</span> <span class="fl">2</span>, discrete_model <span class="op">=</span> <span class="st">"ER"</span>, null.model <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                continuous_model <span class="op">=</span> <span class="st">"BMV"</span>, nSim <span class="op">=</span> <span class="fl">25</span>, p <span class="op">=</span> <span class="va">p_bmv_cid</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Negative values detected... adding 50 to the trait mean for optimization purposes</span></span>
<span><span class="co">## Your phylogeny had node labels, these have been removed.</span></span>
<span><span class="co">## Calculating likelihood from a set of fixed parameters.</span></span>
<span><span class="co">## [1] 2.915276e+02 5.319353e-03 1.728115e-04 5.529171e+00 2.053390e-01</span></span>
<span><span class="co">## [6] 1.666330e-01 5.131845e+01</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_oum_cid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.206646e+02</span>, <span class="fl">1.639380e-02</span>, <span class="fl">1.172179e-03</span>, <span class="fl">1.639380e+00</span>, <span class="fl">1.977996e-01</span>, <span class="fl">2.080072e-01</span>, <span class="fl">3.560215e-01</span>, <span class="fl">1.518203e+00</span><span class="op">)</span></span>
<span><span class="va">pp_oum_cid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hOUwie.html">hOUwie</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">trait</span>, rate.cat <span class="op">=</span> <span class="fl">2</span>, discrete_model <span class="op">=</span> <span class="st">"ER"</span>, null.model <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                continuous_model <span class="op">=</span> <span class="st">"OUM"</span>, nSim <span class="op">=</span> <span class="fl">25</span>, p <span class="op">=</span> <span class="va">p_oum_cid</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Negative values detected... adding 50 to the trait mean for optimization purposes</span></span>
<span><span class="co">## Your phylogeny had node labels, these have been removed.</span></span>
<span><span class="co">## Calculating likelihood from a set of fixed parameters.</span></span>
<span><span class="co">## [1] 3.206646e+02 1.639380e-02 1.172179e-03 1.639380e+00 1.977996e-01</span></span>
<span><span class="co">## [6] 2.080072e-01 5.035602e+01 5.151820e+01</span></span></code></pre>
<p>One thing to note is that these rate category two models are more
difficult to fit than rate category one models using the simulation
approach. This is because there is a lot more mapping space to explore
and with the number of stochastic maps being so low (nSim=25) for this
demonstration, it’s hard to achieve a good likelihood. Nonetheless, let
us create our full model set and examine our model table.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bm1_fit <span class="op">=</span> <span class="va">pp_bm1</span>, ou1_fit <span class="op">=</span> <span class="va">pp_ou1</span>, bmv_fit <span class="op">=</span> <span class="va">pp_bmv</span>,</span>
<span>                  oum_fit <span class="op">=</span> <span class="va">pp_oum</span>, bmv_cid_fit <span class="op">=</span> <span class="va">pp_bmv_cid</span>, oum_cid_fit <span class="op">=</span> <span class="va">pp_oum_cid</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/getModelTable.html">getModelTable</a></span><span class="op">(</span><span class="va">model_set</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             np     lnLik    DiscLik   ContLik      BIC      dBIC        BICwt</span></span>
<span><span class="co">## bm1_fit      3 -27.21968  -5.260506 -18.74030 66.91602  4.005475 1.154708e-01</span></span>
<span><span class="co">## ou1_fit      4 -27.18725  -5.268256 -18.70012 71.01004  8.099494 1.490964e-02</span></span>
<span><span class="co">## bmv_fit      4 -23.13751  -5.257222 -16.23687 62.91054  0.000000 8.555586e-01</span></span>
<span><span class="co">## oum_fit      5 -25.16650  -5.268176 -19.40598 71.12741  8.216869 1.405981e-02</span></span>
<span><span class="co">## bmv_cid_fit  7 -34.84145 -12.118765 -19.50565 98.79509 35.884545 1.380447e-08</span></span>
<span><span class="co">## oum_cid_fit  8 -28.35434  -5.300068 -20.72064 89.97974 27.069196 1.133048e-06</span></span></code></pre>
<p>It’s important to account for our model selection uncertainty.
Although sometimes you will find that a single model best explains the
data, most of the time there will be several reasonable explanations of
the data (similar AICs). To integrate over this uncertainty we conduct
model averaging and utilize the averaged parameters (Burnham and
Anderson 2002). This is done in getModelAvgParams. These provide
parameter estimates per tip, averaging over the uncertainty in model
selection (See: Caetano et al. (2018) and Vasoncelos et al. (2021) for
more detail).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_avg_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getModelAvgParams.html">getModelAvgParams</a></span><span class="op">(</span><span class="va">model_set</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">model_avg_pars</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         rates       alpha   sigma.sq    theta expected_mean expected_var</span></span>
<span><span class="co">## t1 0.01663494 0.008033828 0.07982736 1.449367      1.449367    0.2814702</span></span>
<span><span class="co">## t2 0.01663494 0.008033828 0.07982736 1.449367      1.449367    0.2814702</span></span>
<span><span class="co">## t3 0.01663494 0.008033828 0.07982736 1.449367      1.449367    0.2814702</span></span>
<span><span class="co">## t4 0.01663494 0.008033828 0.07982736 1.449367      1.449367    0.2814702</span></span>
<span><span class="co">## t5 0.01663494 0.008033828 0.07982736 1.449367      1.449367    0.2814702</span></span>
<span><span class="co">## t6 0.01663494 0.008033828 0.07982736 1.449367      1.449367    0.2814702</span></span>
<span><span class="co">##    tip_state</span></span>
<span><span class="co">## t1         1</span></span>
<span><span class="co">## t2         1</span></span>
<span><span class="co">## t3         1</span></span>
<span><span class="co">## t4         1</span></span>
<span><span class="co">## t5         1</span></span>
<span><span class="co">## t6         1</span></span></code></pre>
<p>We can then summarize these results using reshape2 and ggplot2.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu">melt</span><span class="op">(</span><span class="va">model_avg_pars</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Using tip_state as id variables</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">tip_state</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">tip_state</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span>, shape <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span>fun<span class="op">=</span><span class="va">mean</span>,geom<span class="op">=</span><span class="st">"point"</span>,<span class="fu">aes</span><span class="op">(</span>group<span class="op">=</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span>fun.data <span class="op">=</span> <span class="st">"mean_se"</span>, geom <span class="op">=</span> <span class="st">"errorbar"</span>, <span class="fu">aes</span><span class="op">(</span>group<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.15</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">variable</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hOUwieStarterGuide_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>This takes all tip rate estimates and averages the results for the
observed state. What we see is that even though our best model (BMV)
only predicts a difference between estimates of sigma.sq, by
incorporating information from other reasonably good models there is a
slight difference in the predicted optima (theta) as well.</p>
</div>
<div class="section level3">
<h3 id="advanced-usage">Advanced usage<a class="anchor" aria-label="anchor" href="#advanced-usage"></a>
</h3>
<p>Up until this point we have been dealing with one of several default
models for both the discrete and continuous character. However, in my
opinion, the more exciting way to approach using hOUwie is by
customizing your discrete and continuous models to test a set of
interesting hypotheses. This is what we will dive into now, as well as
some of the more technical options available to users.</p>
<p>Say we are interested in whether optimal flower size (continuous
variable) is correlated with flower scent (Scent = 0 or 1) or whether
flower size is correlated with flower color (Color = red or blue). We
have a few things to consider as alternative hypotheses. First, we will
need to structure a model such that the optimum flower size is dependent
on flower scent (M1). We will need a model where the optimum flower size
is dependent on flower color (M2). We could also have a model where both
flower scent and flower color correlate with the optimal flower size
(M3). Then, of course we will need some “null” models as well. These are
models in which flower size is independent of our focal discrete
characters. We will have the standard null models (OU1 and BM1) where
there is no heterogeneity in flower size evolution, and we will run some
CID+ models that allow for rate variation in flower size evolution that
is independent of our focal discrete characters.</p>
<p>I will also note that you can adjust the discrete character evolution
as well. More details about this are given in the corHMM vignette and
help functions. But essentially, we could ask the question of whether
flower color and flower scent are correlated. Structuring our discrete
models in particular ways can assess that question. For our purposes
here though, we won’t delve into that.</p>
<p>Let’s take a look at some hypothetical data.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simulated data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">flower_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   sp scent color      size</span></span>
<span><span class="co">## 1 t1     1  blue  9.160227</span></span>
<span><span class="co">## 2 t2     0  blue  9.858286</span></span>
<span><span class="co">## 3 t3     1  blue  9.061639</span></span>
<span><span class="co">## 4 t4     0  blue 10.021362</span></span>
<span><span class="co">## 5 t5     0   red  5.410799</span></span>
<span><span class="co">## 6 t6     1   red  5.495283</span></span></code></pre>
<p>And if we plot our data…</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree</span>, show.tip.label <span class="op">=</span> <span class="cn">FALSE</span>, x.lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, no.margin <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/nodelabels.html" class="external-link">tiplabels</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">21</span>, col <span class="op">=</span> <span class="va">flower_data</span><span class="op">$</span><span class="va">scent</span>, cex <span class="op">=</span> <span class="fl">0.75</span>, offset <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/nodelabels.html" class="external-link">tiplabels</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="va">flower_data</span><span class="op">$</span><span class="va">color</span>, cex <span class="op">=</span> <span class="fl">0.75</span>, offset <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">proportions</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">plotting_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3.6</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span>, <span class="fl">3.6</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0.4</span> <span class="op">*</span> <span class="va">proportions</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">64</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">plotting_matrix</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="hOUwieStarterGuide_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>So it seems that there may be some correlation between flower color
and optimal flower size, with blue flowers looking a little bit larger
than red flowers. But, let’s create our model set and see what the
models say.</p>
</div>
<div class="section level3">
<h3 id="creating-a-custom-model-set">Creating a custom model set<a class="anchor" aria-label="anchor" href="#creating-a-custom-model-set"></a>
</h3>
<p>There are several functions which can aid you create a custom set of
models. Here we will be focusing on custom continuous models, but
similar things can be done for discrete models (for discrete models see
the corHMM vignette). Let’s start with the our simplest model BM1.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ou1_structure</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getOUParamStructure.html">getOUParamStructure</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"OU1"</span>, nObsState <span class="op">=</span> <span class="fl">4</span>, rate.cat <span class="op">=</span> <span class="fl">1</span>, null.model <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ou1_structure</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        (1) (2) (3) (4)</span></span>
<span><span class="co">## alpha    1   1   1   1</span></span>
<span><span class="co">## sigma2   2   2   2   2</span></span>
<span><span class="co">## theta    3   3   3   3</span></span></code></pre>
<p>The function we use is called getOUParamStructure. We indicate the
model we want (OU1), the number of observed states (4 in this case), the
number of rate categories, and a TRUE or FALSE as to whether this is a
null model. Null model for this argument really refers to a model with
character independent rate heterogeneity. OU1 uses the same rate and
optima throughout the phylogeny, so we set this argument to FALSE.</p>
<p>Each row represents a particular parameter and each column represents
a state. All of the sigma squared, alpha, and theta values are the same
for each character as is theta.</p>
<p>We can then use this structure in our hOUwie function call as a
custom input model.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_ou1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">1.5</span>, <span class="fl">7.5</span><span class="op">)</span> <span class="co"># note: not the mle</span></span>
<span><span class="va">ou1_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hOUwie.html">hOUwie</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">flower_data</span>, rate.cat <span class="op">=</span> <span class="fl">1</span>, discrete_model <span class="op">=</span> <span class="st">"ER"</span>, </span>
<span>                continuous_model <span class="op">=</span> <span class="va">ou1_structure</span>, nSim <span class="op">=</span> <span class="fl">50</span>, p <span class="op">=</span> <span class="va">p_ou1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Your phylogeny had node labels, these have been removed.</span></span>
<span><span class="co">## Calculating likelihood from a set of fixed parameters.</span></span>
<span><span class="co">## [1] 1.0 3.0 1.5 7.5</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ou1_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Fit</span></span>
<span><span class="co">##     lnLTot   lnLDisc   lnLCont      AIC     AICc      BIC nTaxa nPars</span></span>
<span><span class="co">##  -532.6681 -117.0947 -411.6614 1073.336 1074.014 1081.972    64     4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Legend</span></span>
<span><span class="co">##        1        2        3        4 </span></span>
<span><span class="co">## "0_blue"  "0_red" "1_blue"  "1_red" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regime Rate matrix</span></span>
<span><span class="co">##     (1) (2) (3) (4)</span></span>
<span><span class="co">## (1)  NA   1   1  NA</span></span>
<span><span class="co">## (2)   1  NA  NA   1</span></span>
<span><span class="co">## (3)   1  NA  NA   1</span></span>
<span><span class="co">## (4)  NA   1   1  NA</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## OU Estimates</span></span>
<span><span class="co">##        (1) (2) (3) (4)</span></span>
<span><span class="co">## alpha  3.0 3.0 3.0 3.0</span></span>
<span><span class="co">## sigma2 1.5 1.5 1.5 1.5</span></span>
<span><span class="co">## theta  7.5 7.5 7.5 7.5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Half-life (another way of reporting alpha)</span></span>
<span><span class="co">##       (1)       (2)       (3)       (4) </span></span>
<span><span class="co">## 0.2310491 0.2310491 0.2310491 0.2310491</span></span></code></pre>
<p>At this point you may ask, why would I create a custom model when I
could have simply set “OU1” into the continuous_model argument and been
done already? The answer is that this way provides much greater
flexibility. The getOUParamStructure function is just a quick way to
give you a matrix in the hOUwie format that you can then customize.</p>
<p>For example, let’s take the ou1_structure and structure a model to
match our first hypothesis. M1 was supposed to test whether flower size
is dependent on flower scent. This means changing the parameters of ou1
to match differing optima for flower scent present and flower scent
absent. Now, the matrix currently is in the form (1), (2), (3), (4). How
do we know which state is which? Honestly, the most robust way is to run
a hOUwie model with a fixed set of parameters and look at the legend
output. Alternatively, you can use a function from corHMM that hOUwie
uses internally called getStateMat4Dat. The only catch for this function
is that you have to remove the continuous character from your data.frame
since it’s used for discrete characers.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">getStateMat4Dat</span><span class="op">(</span><span class="va">flower_data</span><span class="op">[</span>,<span class="op">-</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">legend</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        1        2        3        4 </span></span>
<span><span class="co">## "0_blue"  "0_red" "1_blue"  "1_red"</span></span></code></pre>
<p>Nonetheless, we now have our legend and can see that flower scent is
abscent (0) for states 1 and 2, and present (1) for states 3 and 4.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1_structure</span> <span class="op">&lt;-</span> <span class="va">ou1_structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Original OU1 structure"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Original OU1 structure"</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">m1_structure</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        (1) (2) (3) (4)</span></span>
<span><span class="co">## alpha    1   1   1   1</span></span>
<span><span class="co">## sigma2   2   2   2   2</span></span>
<span><span class="co">## theta    3   3   3   3</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1_structure</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Modified to allow differing optima based on flower scent"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Modified to allow differing optima based on flower scent"</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">m1_structure</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        (1) (2) (3) (4)</span></span>
<span><span class="co">## alpha    1   1   1   1</span></span>
<span><span class="co">## sigma2   2   2   2   2</span></span>
<span><span class="co">## theta    3   3   4   4</span></span></code></pre>
<p>We can do the same thing for M2 and M3 which predicted that the
optimal flower sized depends on flower color and it depends on the
combination of flower color and scent respectively.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m3_structure</span> <span class="op">&lt;-</span> <span class="va">m2_structure</span> <span class="op">&lt;-</span> <span class="va">ou1_structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Original OU1 structure"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Original OU1 structure"</span></span></code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">m1_structure</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        (1) (2) (3) (4)</span></span>
<span><span class="co">## alpha    1   1   1   1</span></span>
<span><span class="co">## sigma2   2   2   2   2</span></span>
<span><span class="co">## theta    3   3   4   4</span></span></code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2_structure</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"M2: Depends on flower color"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "M2: Depends on flower color"</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">m2_structure</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        (1) (2) (3) (4)</span></span>
<span><span class="co">## alpha    1   1   1   1</span></span>
<span><span class="co">## sigma2   2   2   2   2</span></span>
<span><span class="co">## theta    3   4   3   4</span></span></code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m3_structure</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"M3: Depends on flower scent and flower color"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "M3: Depends on flower scent and flower color"</span></span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">m3_structure</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        (1) (2) (3) (4)</span></span>
<span><span class="co">## alpha    1   1   1   1</span></span>
<span><span class="co">## sigma2   2   2   2   2</span></span>
<span><span class="co">## theta    3   4   5   6</span></span></code></pre>
<p>Each of these models can be fit and added to our growing model
set.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span> <span class="co"># note: not the mle</span></span>
<span><span class="va">m1_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hOUwie.html">hOUwie</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">flower_data</span>, rate.cat <span class="op">=</span> <span class="fl">1</span>, discrete_model <span class="op">=</span> <span class="st">"ER"</span>, </span>
<span>                continuous_model <span class="op">=</span> <span class="va">m1_structure</span>, nSim <span class="op">=</span> <span class="fl">50</span>, p <span class="op">=</span> <span class="va">p_m1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Your phylogeny had node labels, these have been removed.</span></span>
<span><span class="co">## Calculating likelihood from a set of fixed parameters.</span></span>
<span><span class="co">## [1]  1.0  1.0  1.5  5.0 10.0</span></span></code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">1.5</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span> <span class="co"># note: not the mle</span></span>
<span><span class="va">m2_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hOUwie.html">hOUwie</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">flower_data</span>, rate.cat <span class="op">=</span> <span class="fl">1</span>, discrete_model <span class="op">=</span> <span class="st">"ER"</span>, </span>
<span>                continuous_model <span class="op">=</span> <span class="va">m2_structure</span>, nSim <span class="op">=</span> <span class="fl">50</span>, p <span class="op">=</span> <span class="va">p_m1</span>, adaptive_sampling <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Your phylogeny had node labels, these have been removed.</span></span>
<span><span class="co">## Calculating likelihood from a set of fixed parameters.</span></span>
<span><span class="co">## [1]  1.0  1.0  1.5  5.0 10.0</span></span></code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">11</span>, <span class="fl">6</span>, <span class="fl">12</span><span class="op">)</span> <span class="co"># note: not the mle</span></span>
<span><span class="va">m3_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hOUwie.html">hOUwie</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">flower_data</span>, rate.cat <span class="op">=</span> <span class="fl">1</span>, discrete_model <span class="op">=</span> <span class="st">"ER"</span>, </span>
<span>                continuous_model <span class="op">=</span> <span class="va">m3_structure</span>, nSim <span class="op">=</span> <span class="fl">50</span>, p <span class="op">=</span> <span class="va">p_m3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Your phylogeny had node labels, these have been removed.</span></span>
<span><span class="co">## Calculating likelihood from a set of fixed parameters.</span></span>
<span><span class="co">## [1]  1  3  2  5 11  6 12</span></span></code></pre>
<p>Let’s put them all in a list and see what the relative fits of each
model was.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/getModelTable.html">getModelTable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ou1 <span class="op">=</span> <span class="va">ou1_fit</span>, m1 <span class="op">=</span> <span class="va">m1_fit</span>, m2 <span class="op">=</span> <span class="va">m2_fit</span>, m3 <span class="op">=</span> <span class="va">m3_fit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     np     lnLik   DiscLik   ContLik       BIC       dBIC         BICwt</span></span>
<span><span class="co">## ou1  4 -532.6681 -117.0947 -411.6614 1081.9717  418.04733  1.667923e-91</span></span>
<span><span class="co">## m1   5 -356.7749 -116.1629 -222.5689  734.3441   70.41975  5.111463e-16</span></span>
<span><span class="co">## m2   5 -321.5650 -113.9567 -194.2737  663.9244    0.00000  1.000000e+00</span></span>
<span><span class="co">## m3   7 -889.3635 -114.6857 -763.8819 1807.8392 1143.91487 3.999830e-249</span></span></code></pre>
<p>So based on these results we could conclude fairly substantial
evidence for model 2 which suggested that the optimum of flower size is
correlated with flower color. Obviously, for a real analysis we would
need to add in more character independent null models for a robust test.
And since our state space is increased, we should also consider running
with a higher number of stochastic maps per iteration (nSim = 100 at
least).</p>
<p>More to be added here as time goes on.</p>
</div>
</div>
<div class="section level2">
<h2 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h2>
<p>A couple of tips for troubleshooting any issues. Try using fixed
parameters (the p argument) and seeing if it is able to run then. Try
using a lower number of underlying regimes for a quick check (nSim = 10)
that the model is what you expect. Ensure that you have the correct
number of rate categories for your model (if you’re using hidden states
is &gt; 1). Make sure that all models have the same number of regime
mappings per iteration (nSim should be the same across all compared
models). Variable alpha models can have very odd behavior, unless you
have a hypothesis specifically about them, I’d go so far as to recommend
avoiding them. I’ll add more once I have my beta testers.</p>
</div>
<div class="section level2">
<h2 id="faqs">FAQs<a class="anchor" aria-label="anchor" href="#faqs"></a>
</h2>
<div class="section level3">
<h3 id="why-does-joint-modeling-matter">Why does joint modeling matter?<a class="anchor" aria-label="anchor" href="#why-does-joint-modeling-matter"></a>
</h3>
<p>Let’s consider what a joint probability is and how it differs from
the combination of marginal probabilities. In essence, a joint
probability is “non-trivial” when it differs from the combination of
marginal probabilities. A marginal probability is simply the probability
of some event occurring, independent of other events. So, flipping a
coin (1/2) or rolling a die (1/6). The probability of flipping a head is
1/2 and the probability of rolling a 3 is 1/6, their joint probabilities
are then 1/12. However, this is only true if the events do not influence
one another. Let’s change the rules and say that if I roll a 1, 2, or 3
the coin becomes heads on both sides, and if I roll a 4, 5, or 6 the
coin becomes tails on both sides. Now the probability distribution
changes and the probability of rolling a head and rolling a 3 becomes
1/2. You’ll notice that independently, an observer of each event without
knowledge of the other would still see 1/2 probability of heads and
tails and 1/6 for any particular dice roll. So, if we expect that
changes in our continuous character influence changes in our discrete
character, or changes in our discrete character influence our continuous
character, the modeling these processes jointly is important.</p>
</div>
<div class="section level3">
<h3 id="why-doesnt-discrete-plus-continuous-likelihood-equal-total-likelihood-lnldisc-lnlcont-lnltot">Why doesn’t discrete plus continuous likelihood equal total
likelihood (lnLDisc + lnLCont = lnLTot)?<a class="anchor" aria-label="anchor" href="#why-doesnt-discrete-plus-continuous-likelihood-equal-total-likelihood-lnldisc-lnlcont-lnltot"></a>
</h3>
<p>The discrete and continuous likelihoods are actually the marginal
probabilities of each character type given our set of regime mappings.
In contrast, the total likelihood is the sum of the joint probabilities
which are combined per regime mapping.</p>
</div>
<div class="section level3">
<h3 id="how-long-is-my-run-going-to-take">How long is my run going to take?<a class="anchor" aria-label="anchor" href="#how-long-is-my-run-going-to-take"></a>
</h3>
<p>How many species are you running? It’s going to depend a lot on the
number of species in your phylogeny and how many stochastic maps you’re
using per iteration. For a few hundred taxa, I’d expect most model fits
to be done in hours. For a few thousand, I’d give it a day or more. And
for tens of thousands, it could take upwards of a month And of course,
the more regimes you are testing per iteration the longer it will take.
Our adaptive sampling algorithm and conditional node sampling helps you
cut down on an exhaustive search (so you can search less), but it will
still take time. Parallel computing helps a lot. If you have access to
these types of resources, I would recommend paralleling different model
structures across several cores.</p>
</div>
<div class="section level3">
<h3 id="why-is-houwie-so-slow">Why is hOUwie so slow?<a class="anchor" aria-label="anchor" href="#why-is-houwie-so-slow"></a>
</h3>
<p>It’s a simulation approach. So we have to simulate many underlying
discrete regimes in order to integrate over the uncertainty deep in time
of any particular discrete regime. This is a very important step, but
given that there are very few high probability regime mappings doing an
exhaustive search isn’t necessary. The other thing I will say is that I
implemented A LOT of tricks to make this go faster. Our stochastic
mapping procedure is very fast, calculating conditional probabilities
only once and never double calculating anything unnecessarily (maybe
some exceptions I missed). I also implemented the brilliant three.point
of Ho and Ane (2014) which calculates the continuous character
probability incredibly quickly. If you’re unconvinced by the speed of
this implementation run OUwie with algorithm = three.point compared to
invert. Nonetheless, my goal is to make hOUwie faster by calculating the
correct expectation, variance, and covariance for the joint process.
Until then, we’re stuck with simulation.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jeremy Beaulieu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
